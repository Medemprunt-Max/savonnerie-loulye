---
import Layout from '../../layouts/Layout.astro';
import ProductCard from '../../components/ProductCard.astro';
import { getCollection } from 'astro:content';

const allProducts = await getCollection('products');
const products = allProducts.sort((a, b) => a.data.name.localeCompare(b.data.name));

const categories = [
  { key: 'all', label: 'Tous' },
  { key: 'savon', label: 'Savons' },
  { key: 'cosmetique', label: 'Cosmétiques' },
  { key: 'bougie', label: 'Bougies & fondants' },
  { key: 'accessoire', label: 'Accessoires' },
  { key: 'coffret', label: 'Coffrets' },
];
---

<Layout title="Boutique — Savonnerie Loulye" description="Découvrez nos savons artisanaux, bougies, cosmétiques et coffrets cadeaux, fabriqués à la main dans le Valgaudemar.">

  <!-- ═══ HERO BOUTIQUE ═══ -->
  <section class="bg-beige py-16 sm:py-20">
    <div class="container-site text-center">
      <span class="text-ocre text-sm font-medium tracking-widest uppercase">Notre boutique</span>
      <h1 class="mt-3 font-serif text-4xl sm:text-5xl font-semibold text-gray-800">
        Nos créations artisanales
      </h1>
      <p class="mt-4 text-gray-600 max-w-xl mx-auto leading-relaxed">
        Savons saponifiés à froid, bougies parfumées, cosmétiques naturels et coffrets cadeaux. Tous nos produits sont fabriqués à la main dans notre atelier du Valgaudemar.
      </p>
    </div>
  </section>

  <!-- ═══ FILTRES + GRILLE ═══ -->
  <section class="py-12 sm:py-16">
    <div class="container-site">

      <!-- Filtres catégories -->
      <div id="category-filters" class="flex flex-wrap gap-2 sm:gap-3 justify-center mb-10">
        {categories.map((cat) => (
          <button
            data-category={cat.key}
            class:list={[
              'filter-btn px-4 py-2 text-sm font-medium rounded-sm border transition-colors duration-200',
              cat.key === 'all'
                ? 'bg-ocre text-white border-ocre'
                : 'bg-white text-gray-600 border-lin hover:border-ocre hover:text-ocre'
            ]}
          >
            {cat.label}
          </button>
        ))}
      </div>

      <!-- Grille produits -->
      <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {products.map((product) => (
          <div class="product-item" data-category={product.data.category}>
            <ProductCard
              slug={product.id.replace(/\.md$/, '')}
              name={product.data.name}
              price={product.data.price}
              image={product.data.image}
              shortDescription={product.data.shortDescription}
              category={product.data.category}
            />
          </div>
        ))}
      </div>

      <!-- Message aucun résultat -->
      <p id="no-results" class="hidden text-center text-gray-500 mt-12 text-lg">
        Aucun produit dans cette catégorie pour le moment.
      </p>
    </div>
  </section>

</Layout>

<script>
  const filterButtons = document.querySelectorAll<HTMLButtonElement>('.filter-btn');
  const productItems = document.querySelectorAll<HTMLElement>('.product-item');
  const noResults = document.getElementById('no-results');

  filterButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const category = btn.dataset.category;

      // Update active button styles
      filterButtons.forEach((b) => {
        b.classList.remove('bg-ocre', 'text-white', 'border-ocre');
        b.classList.add('bg-white', 'text-gray-600', 'border-lin');
      });
      btn.classList.remove('bg-white', 'text-gray-600', 'border-lin');
      btn.classList.add('bg-ocre', 'text-white', 'border-ocre');

      // Filter products
      let visibleCount = 0;
      productItems.forEach((item) => {
        const show = category === 'all' || item.dataset.category === category;
        item.style.display = show ? '' : 'none';
        if (show) visibleCount++;
      });

      // Toggle "no results" message
      if (noResults) {
        noResults.classList.toggle('hidden', visibleCount > 0);
      }
    });
  });
</script>
