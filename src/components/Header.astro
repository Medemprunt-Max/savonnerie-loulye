---
const navLinks = [
  { label: 'Accueil', href: '/' },
  { label: 'Boutique', href: '/boutique' },
  { label: 'Ateliers', href: '/ateliers' },
  { label: 'A propos', href: '/a-propos' },
  { label: 'Contact', href: '/contact' },
];
const currentPath = Astro.url.pathname;
---

<header id="site-header" class="fixed top-0 left-0 right-0 z-50 bg-blanc-casse/95 backdrop-blur-sm border-b border-lin/50 transition-shadow duration-300">
  <div class="container-site">
    <div class="flex items-center justify-between h-16 md:h-20">
      <a href="/" class="flex items-center gap-2 group">
        <span class="font-serif text-xl md:text-2xl font-semibold text-gray-800 tracking-wide group-hover:text-ocre transition-colors">Savonnerie Loulye</span>
      </a>
      <nav class="hidden md:flex items-center gap-8" aria-label="Navigation principale">
        {navLinks.map((link) => (
          <a href={link.href} class:list={['text-sm font-medium tracking-wide uppercase transition-colors relative after:content-[""] after:absolute after:-bottom-1 after:left-0 after:h-0.5 after:bg-ocre after:transition-all after:duration-300', currentPath === link.href ? 'text-ocre after:w-full' : 'text-gray-600 hover:text-ocre after:w-0 hover:after:w-full']}>{link.label}</a>
        ))}
      </nav>
      <div class="flex items-center gap-4">
        <a href="/panier" class="relative p-2 text-gray-600 hover:text-ocre transition-colors" aria-label="Voir le panier">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"/></svg>
          <span id="cart-badge" class="absolute -top-0.5 -right-0.5 w-5 h-5 bg-ocre text-white text-xs font-bold rounded-full flex items-center justify-center hidden" aria-label="Articles dans le panier">0</span>
        </a>
        <button id="mobile-menu-toggle" class="md:hidden p-2 text-gray-600 hover:text-ocre transition-colors" aria-label="Ouvrir le menu" aria-expanded="false" aria-controls="mobile-menu">
          <svg id="icon-open" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg>
          <svg id="icon-close" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
    </div>
  </div>
  <div id="mobile-menu" class="md:hidden overflow-hidden max-h-0 transition-all duration-300 ease-in-out bg-blanc-casse border-t border-lin/30">
    <nav class="container-site py-4 flex flex-col gap-1" aria-label="Navigation mobile">
      {navLinks.map((link) => (
        <a href={link.href} class:list={['block py-3 px-4 rounded-sm text-base font-medium transition-colors', currentPath === link.href ? 'text-ocre bg-beige' : 'text-gray-600 hover:text-ocre hover:bg-beige/50']}>{link.label}</a>
      ))}
    </nav>
  </div>
</header>
<div class="h-16 md:h-20"></div>

<script>
  const toggle = document.getElementById('mobile-menu-toggle');
  const menu = document.getElementById('mobile-menu');
  const iconOpen = document.getElementById('icon-open');
  const iconClose = document.getElementById('icon-close');
  if (toggle && menu && iconOpen && iconClose) {
    toggle.addEventListener('click', () => {
      const isOpen = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', String(!isOpen));
      toggle.setAttribute('aria-label', isOpen ? 'Ouvrir le menu' : 'Fermer le menu');
      iconOpen.classList.toggle('hidden', !isOpen);
      iconClose.classList.toggle('hidden', isOpen);
      menu.style.maxHeight = isOpen ? '0' : menu.scrollHeight + 'px';
    });
  }
  const header = document.getElementById('site-header');
  if (header) {
    window.addEventListener('scroll', () => {
      header.classList.toggle('shadow-md', window.scrollY > 10);
    });
  }
  function updateCartBadge() {
    const badge = document.getElementById('cart-badge');
    if (!badge) return;
    try {
      const cart = JSON.parse(localStorage.getItem('loulye-cart') || '[]');
      const count = cart.reduce((sum, item) => sum + (item.qty || 0), 0);
      badge.textContent = String(count);
      badge.classList.toggle('hidden', count === 0);
    } catch { badge.classList.add('hidden'); }
  }
  updateCartBadge();
  window.addEventListener('storage', updateCartBadge);
  document.addEventListener('cart-updated', updateCartBadge);
</script>
